<!DOCTYPE html>
<html>
<head>
  <title>AuditBot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    .file-type-chart .arc:hover {
      opacity: 0.8;
    }
    .file-list::-webkit-scrollbar {
      width: 8px;
    }
    .file-list::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    .file-list::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }
  </style>
</head>
<body class="bg-gray-100">
  <div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-3xl font-bold text-gray-800">AuditBot</h1>
      <button id="scanBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg">
        Start Scan
      </button>
    </div>

    <!-- Dashboard -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <!-- Statistics Card -->
      <div class="bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-4">Scan Statistics</h2>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <p class="text-gray-600">Total Files</p>
            <p id="totalFiles" class="text-2xl font-bold">-</p>
          </div>
          <div>
            <p class="text-gray-600">Total Size</p>
            <p id="totalSize" class="text-2xl font-bold">-</p>
          </div>
          <div>
            <p class="text-gray-600">Duplicates Found</p>
            <p id="duplicatesFound" class="text-2xl font-bold">-</p>
          </div>
          <div>
            <p class="text-gray-600">Potential Space Savings</p>
            <p id="spaceSavings" class="text-2xl font-bold">-</p>
          </div>
        </div>
      </div>

      <!-- File Type Distribution -->
      <div class="bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-4">File Type Distribution</h2>
        <div id="fileTypeChart" class="w-full h-64"></div>
      </div>
    </div>


<!-- Add this right before the file list table -->
<div class="flex justify-between items-center mb-4">
  <div class="flex-1 max-w-md">
    <div class="relative">
      <input type="text" 
             id="searchInput" 
             class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500" 
             placeholder="Search files...">
      <div class="absolute left-3 top-2.5">
        <svg class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
        </svg>
      </div>
    </div>
  </div>
  <div class="ml-4 flex items-center">
    <span class="text-sm text-gray-500 mr-2">Filter:</span>
    <select id="filterSelect" class="border rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500">
      <option value="all">All Files</option>
      <option value="duplicates">Duplicates</option>
      <option value="unused">Unused</option>
      <option value="cache">Cache Files</option>
    </select>
  </div>
</div>

    <!-- File List -->
    <div class="bg-white rounded-lg shadow-md">
      <div class="p-6">
        <h2 class="text-xl font-semibold mb-4">File Analysis</h2>
        <div class="flex gap-4 mb-4">
          <button id="showDuplicates" class="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600">
            Show Duplicates
          </button>
          <button id="showUnused" class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600">
            Show Unused Files
          </button>
          <button id="showCache" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
            Show Cache Files
          </button>
        </div>
      </div>
      <div class="border-t border-gray-200">
        <div class="file-list overflow-y-auto max-h-96">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  <input type="checkbox" id="selectAll" class="rounded">
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  File Name
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Size
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Last Accessed
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Type
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Status
                </th>
              </tr>
            </thead>
            <tbody id="fileList" class="bg-white divide-y divide-gray-200">
              <!-- File rows will be inserted here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="mt-6 flex justify-end">
      <button id="cleanupBtn" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
        Clean Selected Files
      </button>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');
    
    // Utility functions
    function formatSize(bytes) {
      const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
      if (bytes === 0) return '0 Bytes';
      const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
      return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
    }

    function formatDate(date) {
      return new Date(date).toLocaleDateString();
    }

    // D3.js Chart
    function createFileTypeChart(data) {
      const width = 400;
      const height = 250;
      const radius = Math.min(width, height) / 2;

      // Clear previous chart
      d3.select("#fileTypeChart").selectAll("*").remove();

      const svg = d3.select("#fileTypeChart")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g")
        .attr("transform", `translate(${width/2},${height/2})`);

      const color = d3.scaleOrdinal(d3.schemeCategory10);

      const pie = d3.pie()
        .value(d => d.value.size);

      const arc = d3.arc()
        .innerRadius(radius * 0.4)
        .outerRadius(radius * 0.8);

      const arcs = svg.selectAll("arc")
        .data(pie(Object.entries(data)))
        .enter()
        .append("g")
        .attr("class", "arc");

      arcs.append("path")
        .attr("d", arc)
        .attr("fill", d => color(d.data[0]));

      arcs.append("text")
        .attr("transform", d => `translate(${arc.centroid(d)})`)
        .attr("text-anchor", "middle")
        .text(d => {
          const percentage = (d.data[1].size / totalSize * 100).toFixed(1);
          return percentage > 5 ? `${d.data[0]} (${percentage}%)` : '';
        })
        .style("font-size", "12px")
        .style("fill